# Como criar um aplicativo com Python e GTK no ChromeOS

Como preparar o ambiente de desenvolvimento no Chromebook para a cria√ß√£o de aplicativos com a linguagem de programa√ß√£o [Python](https://www.python.org/) ([PyGObject](https://pypi.org/project/PyGObject/)) e o toolkit gr√°fico [GTK](https://www.gtk.org/) no Chromebook ([ChromeOS](https://chromeenterprise.google/intl/pt_br/os/)) ü§©.

> **OBS**: Antes de mais nada, √© necess√°rio que o ambiente Linux esteja configurado no ChromeOS.

> Dependendo da vers√£o do Debian algumas configura√ß√µes adicionais se fazem necess√°rias.

A seguir veremos com mais detalhes esses procedimentos.

---

## Debian Bookworm

A distribui√ß√£o Linux Debian Bookworm possui os pacotes do GTK 4 nos seus reposit√≥rios est√°veis.

Abra o terminal e digite o seguinte comando:

```bash
sudo apt -t sid install \
python3-full \
python3-dev \
python3-gi \
python3-gi-cairo \
libcairo2-dev \
libgirepository1.0-dev \
gir1.2-gtk-4.0 \
libgtk-4-dev \
libadwaita-1-dev
```

Assim que a instala√ß√£o estiver conclu√≠da a linguagem de programa√ß√£o Python no ChromeOS, o binding PyGObject e as bibliotecas gr√°ficas GTK no ChromeOS estar√£o instalados.

---

## Debian Buster e Bullseye

Nessas vers√µes do Debian os pacotes do GTK 4 n√£o est√£o dispon√≠veis nos reposit√≥rios est√°veis e se faz necess√°ria a configura√ß√£o do reposit√≥rio `sid`.

### Debian sid

Para adicionar o **reposit√≥rio sid** √© necess√°rio editar o arquivo `**sources.list**`.

Para editar o arquivo, abra o terminal e utilize um editor de texto como o `vi` ou [vim](https://www.vim.org/), todavia se voc√™ n√£o possui experi√™ncia com esses editores instale o [nano](https://www.nano-editor.org/):

```bash
sudo apt install nano
```

Ap√≥s a instala√ß√£o digite no terminal:

```bash
sudo nano /etc/apt/sources.list
```

Agora, vamos adicionar o reposit√≥rio **testing** (sid) no arquivo `sources.list`:

```bash
# Generated by distrobuilder
deb https://deb.debian.org/debian bullseye main
deb https://deb.debian.org/debian bullseye-updates main
deb https://deb.debian.org/debian-security/ bullseye-security main

deb http://http.us.debian.org/debian sid main non-free contrib
```

> ‚ö†Ô∏è N√ÉO EXECUTE `sudo apt update` OU MESMO `sudo apt upgrade`!

Agora precisamos criar/editar o arquivo `preferences`.

Se essa configura√ß√£o n√£o for feita, o sistema tentar√° atualizar todos os pacotes para as √∫ltimas vers√µes e isso ir√° gerar diversos pacotes quebrados.

No terminal execute:

```bash
sudo nano /etc/apt/preferences
```

Dentro deste arquivo digite o seguinte c√≥digo:

```bash
Package: *
Pin: release a=stable
Pin-Priority: 700

Package: *
Pin: release a=testing
Pin-Priority: 650

Package: *
Pin: release a=unstable
Pin-Priority: 600
```

Salve o arquivo e agora podemos atualizar os reposit√≥rios:

```bash
sudo apt update
```

Assim que a atualiza√ß√£o dos reposit√≥rios for finalizada execute o seguinte comando para instalar os pacotes necess√°rios:

```bash
sudo apt -t sid install \
python3-full \
python3-dev \
python3-gi \
python3-gi-cairo \
libcairo2-dev \
libgirepository1.0-dev \
gir1.2-gtk-4.0 \
libgtk-4-dev \
libadwaita-1-dev
```

Ap√≥s a instala√ß√£o a linguagem de programa√ß√£o Python no ChromeOS, o tookit GTK 4 e o binding `PyGObject` estar√£o instalados e prontos para uso üöÄ.

---

## Ambientes virtuais

Se voc√™ ainda n√£o utiliza, este √© um bom momento para testar algumas op√ß√µes:

* [Poetry](https://python-poetry.org/).
    
* [Pipenv](https://pipenv.pypa.io/en/latest/).
    
* [Pyenv](https://github.com/pyenv/pyenv).
    
* [PDM](https://pdm.fming.dev/).
    
* [venv](https://docs.python.org/3/library/venv.html). Nativo.
    
* Etc.
    

### Criando o ambiente virtual

Acesse a pasta raiz do seu projeto, abra um terminal, em seguida execute o comando:

```bash
python3 -m venv venv
```

Para criar o ambiente virtual utilizando uma **vers√£o espec√≠fica** da linguagem de programa√ß√£o Python no ChromeOS pode ser utilizado comando:

```bash
python3.X -m venv venv
```

> ‚ö†Ô∏è Substitua o `X` pela vers√£o da linguagem de programa√ß√£o Python no ChromeOS que deseja utilizar.

> ‚ö†Ô∏è A vers√£o desejada deve estar instalada no sistema operacional!

### Ativando o ambiente virtual

Ap√≥s ser criado o ambiente virtual **precisa ser ativado**, caso contr√°rio a instala√ß√£o dos pacotes ser√° realizada na instala√ß√£o local da linguagem de programa√ß√£o Python no ChromeOS e n√£o no ambiente virtual.

Para ativar o ambiente virtual:

```bash
source venv/bin/activate
```

### Instalando o binding

**Com o ambiente virtual ativo**, vamos come√ßar atualizando o gerenciador de pacotes do Python (`pip`) com o comando:

```bash
python -m pip install \
--upgrade pip
```

Em seguida vamos instalar o binding `PyGObject` e a biblioteca `PyGObject-stubs` com o comando:

```bash
pip install \
pygobject \
PyGObject-stubs
```

Perfeito! Com isso podemos iniciar o desenvolvimento em um ambiente onde as depend√™ncias est√£o isoladas üòÉ.

---

## Testando

A forma mais simples de testar a comunica√ß√£o entre a linguagem de programa√ß√£o Python no ChromeOS e o toolkit gr√°fico GTK √© executar no terminal o comando:

```bash
python3 -c "import gi"
```

> ‚ö†Ô∏è Lembre-se que o comando deve ser executado com o ambiente virtual ativo!

Se ao executar o comando nenhum erro for retornado, a instala√ß√£o e configura√ß√£o do ambiente Python e GTK no Chromebook est√£o corretas üëçüëãüëã.

---

## C√≥digo de exemplo

Para testar a configura√ß√£o no seu editor de texto ou IDE utilize o seguinte c√≥digo de exemplo:

```python
# -*- coding: utf-8 -*-
"""Python e GTK: PyGObject Gtk.ApplicationWindow()."""

import gi

gi.require_version(namespace='Gtk', version='4.0')
gi.require_version(namespace='Adw', version='1')

from gi.repository import Adw, Gio, Gtk

Adw.init()


class ExampleWindow(Gtk.ApplicationWindow):

    def __init__(self, **kwargs):
        super().__init__(**kwargs)

        self.set_title(title='Python - PyGObjet - GTK:')
        self.set_default_size(width=int(1366 / 2), height=int(768 / 2))
        self.set_size_request(width=int(1366 / 2), height=int(768 / 2))

        headerbar = Gtk.HeaderBar.new()
        self.set_titlebar(titlebar=headerbar)

        menu_button_model = Gio.Menu()
        menu_button_model.append('Prefer√™ncias', 'app.preferences')

        menu_button = Gtk.MenuButton.new()
        menu_button.set_icon_name(icon_name='open-menu-symbolic')
        menu_button.set_menu_model(menu_model=menu_button_model)
        headerbar.pack_end(child=menu_button)

        # O seu c√≥digo aqui:
        # ...


class ExampleApplication(Adw.Application):

    def __init__(self):
        super().__init__(application_id='br.com.justcode.Example',
                         flags=Gio.ApplicationFlags.FLAGS_NONE)

        self.create_action('quit', self.exit_app, ['<primary>q'])
        self.create_action('preferences', self.on_preferences_action)

    def do_activate(self):
        win = self.props.active_window
        if not win:
            win = ExampleWindow(application=self)
        win.present()

    def do_startup(self):
        Gtk.Application.do_startup(self)

    def do_shutdown(self):
        Gtk.Application.do_shutdown(self)

    def on_preferences_action(self, action, param):
        print('A√ß√£o app.preferences foi ativa.')

    def exit_app(self, action, param):
        self.quit()

    def create_action(self, name, callback, shortcuts=None):
        action = Gio.SimpleAction.new(name, None)
        action.connect('activate', callback)
        self.add_action(action)
        if shortcuts:
            self.set_accels_for_action(f'app.{name}', shortcuts)


if __name__ == '__main__':
    import sys

    app = ExampleApplication()
    app.run(sys.argv)
```
